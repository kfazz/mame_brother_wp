Author: Jordi Mallach <jordi@debian.org>
Description: Check for GNU.
 Fix builds on hurd-i386 by checking for __GNU__ and adding a gnu TARGETOS
 that defines NO_AFFINITY_NP.
Forwarded: no

Index: mame-0.146u1/makefile
===================================================================
--- mame-0.146u1.orig/makefile	2012-06-14 15:41:52.000000000 +0200
+++ mame-0.146u1/makefile	2012-06-14 15:58:23.000000000 +0200
@@ -77,6 +77,9 @@
 ifeq ($(firstword $(filter Linux,$(UNAME))),Linux)
 TARGETOS = linux
 endif
+ifeq ($(firstword $(filter GNU,$(UNAME))),GNU)
+TARGETOS = gnu
+endif
 ifeq ($(firstword $(filter Solaris,$(UNAME))),Solaris)
 TARGETOS = solaris
 endif
Index: mame-0.146u1/src/osd/sdl/sdl.mak
===================================================================
--- mame-0.146u1.orig/src/osd/sdl/sdl.mak	2012-06-14 15:41:52.000000000 +0200
+++ mame-0.146u1/src/osd/sdl/sdl.mak	2012-06-14 15:57:11.000000000 +0200
@@ -241,6 +241,13 @@
 
 endif
 
+ifeq ($(TARGETOS),gnu)
+BASE_TARGETOS = unix
+SYNC_IMPLEMENTATION = tc
+SDL_NETWORK = taptun
+DEFS += -DNO_AFFINITY_NP
+endif
+
 ifeq ($(TARGETOS),win32)
 BASE_TARGETOS = win32
 SYNC_IMPLEMENTATION = win32
Index: mame-0.146u1/src/osd/sdl/sdlprefix.h
===================================================================
--- mame-0.146u1.orig/src/osd/sdl/sdlprefix.h	2012-06-14 15:41:52.000000000 +0200
+++ mame-0.146u1/src/osd/sdl/sdlprefix.h	2012-06-14 15:54:21.000000000 +0200
@@ -42,7 +42,7 @@
 /* Large file support on IRIX needs _SGI_SOURCE */
 #undef _POSIX_SOURCE
 
-#elif defined(__linux__) || defined(__FreeBSD_kernel__)
+#elif defined(__linux__) || defined(__GNU__) || defined(__FreeBSD_kernel__)
 #define SDLMAME_LINUX 1
 
 #elif defined(__FreeBSD__)
